# 3.0.0

- 出力したレシピを`plugin_data/Mineflow/addons`フォルダに入れることでアドオンとして読み込めるようになりました．
  - アドオンによって読み込まれたレシピはレシピリストに表示されません．
  - 以下のコマンドが追加されました
    - `/mineflow addon list`: アドオン一覧を表示する
    - `/mineflow addon reload`: `plugin_data/Mineflow/addons`フォルダ内のアドオンを再読み込みする
    - `/mineflow addon load <name>`: `plugin_data/Mineflow/addons/<name>.json`というファイル名のアドオンを読み込む
    - `/mineflow addon unload <name>`: `<name>`という名前のアドオンをアンロードする
  - アドオンを使用してカスタムアクションを追加できるようになりました
- レシピを一時的に無効化できるようになりました．
- レシピ引数に変数のタイプを指定できるようになりました．
- イベントトリガの有効化/無効化が瞬時に反映されるようになりました．
- Added new variables
  - `_.args`: レシピ変数のリスト
- Added new variable properties
  - Number variable
    - floor
    - ceil
    - round
    - abs
- Added new variable methods
  - Number variable
    - floor()
    - ceil()
    - round(precision)
    - abs()
    - pad(length)
- Added new actions
  - Set data in a player variable
    - Stores personal player data in the player variable. To get the data from a player variable, you can use `<player variable name>.data.<data name>` variable. Example) `target.data.money`
- Actions in the `Economy` category have been moved to [MineflowMoreActions](https://github.com/aieuo/MineflowMoreActions) plugin.

## API

### Main
- 以下のメソッドが移動/名前変更されました
  - `Main::getConfig()` -> `Mineflow::getConfig()`
  - `Main::getPlayerSettings()` -> `Mineflow::getPlayerSettings()`
  - `Main::getRecipeManager()` -> `Mineflow::getRecipeManager()`
  - `Main::getCommandManager()` -> `Mineflow::getCommandManager()`
  - `Main::getFormManager()` -> `Mineflow::getFormManager()`
  - `Main::getEventManager()` -> `Mineflow::getEventManager()`
  - `Main::getVariableHelper()` -> `Mineflow::getVariableHelper()`
  - `Main::getPluginVersion()` -> `Mineflow::getPluginVersion()`
  - `Main::getTimeTriggerTimeZone()` -> `Mineflow::getTimeTriggerTimeZone()`
  - `Main::isEnabledRecipeErrorInConsole()` -> `Mineflow::isEnabledRecipeErrorInConsole()`
  - `Main::setEnabledRecipeErrorInConsole()` -> `Mineflow::setEnabledRecipeErrorInConsole()`
- 以下のメソッドが追加されました
  - `Mineflow::getAddonManager()`

### Variable
- 変数の識別タイプがintからstringに変更されました．
- `Variable->callMethod()`がfinalになりました．
    - 変数にメソッドを追加するには`Variable::registerMethod()`を使用してください．
- 以下のクラスが移動/名前変更されました
  - `BoolVariable` -> `BooleanVariable`
  - `(.+)ObjectVariable` -> `$1Variable`
- 以下のメソッドが移動/名前変更されました
    - `Variable->getValueFromIndex()` -> `Variable->getProperty()`
      - 変数にプロパティを追加するには`Variable::registerProperty()`を使用してください．
    - `ObjectVariable->getValueType()` -> `ObjectVariable->getValueClass()`
    - `ObjectVariable::getValuesDummy()` -> `Variable::getPropertyTypes()`
- 以下のメソッドのシグネチャが変更されました
  - `Variable->__construct($value)` -> `Variable->__construct()`
  - `Variable->add($variable): Variable` -> `Variable->add(Variable $variable): Variable`
  - `Variable->sub($variable): Variable` -> `Variable->sub(Variable $variable): Variable`
  - `Variable->mul($variable): Variable` -> `Variable->mul(Variable $variable): Variable`
  - `Variable->div($variable): Variable` -> `Variable->div(Variable $variable): Variable`
  - `ObjectVariable->__construct(object $value, ?string $str = null)` -> `ObjectVariable->__construct()`
  - `DummyVariable->__construct(string $valueType = "", string $description = "")` -> `DummyVariable->__construct(class-string<Variable> $valueClass = "", string $description = "")`
- 以下のメソッドが追加されました
  - `Variable->getTypeName()`
  - `Variable::registerProperty()`
  - `Variable::getProperties()`
  - `Variable::getPropertyTypes()`
  - `Variable::registerMethod()`
  - `Variable::getMethods()`
  - `Variable::getMethodTypes()`
- 以下のメソッドが削除されました
  - `Variable->getType()`
    - 代わりに`Variable->getTypeName()`を使用してください．
  - `ObjectVariable->getShowString()`
    - 代わりに`Variable::__toString()`を使用してください．
  - `Variable->fromArray()`
    - 代わりに`VariableDeserializer->deserialize()`を使用してください．

### Recipe
- `Recipe->loadSaveData`でトリガー,引数,戻り値を読み込むようになりました．
- 以下のメソッドのシグネチャが変更されました
    - `Recipe->executeAllTargets(?Entity $player = null, array $variables = [], ?Event $event = null, array $args = [], ?FlowItemExecutor $callbackExecutor = null): ?bool` -> `Recipe->executeAllTargets(?Entity $player = null, array $variables = [], ?Event $event = null, array $args = [], ?FlowItemExecutor $from = null, ?callable $callback = null): ?bool`
    - `Recipe->execute(?Entity $target, ?Event $event = null, array $variables = [], array $args = [], ?FlowItemExecutor $callbackExecutor = null): bool` -> `Recipe->execute(?Entity $target, ?Event $event = null, array $variables = [], array $arguments = [], ?FlowItemExecutor $from = null, ?callable $callback = null): bool`
- 以下のメソッドが追加されました
    - `Recipe->setEnabled()`
    - `Recipe->isEnabled()`
    - `Recipe->addArgument()`
    - `Recipe->removeArgument()`
    - `Recipe->getAddonDependencies()`
    - `Recipe->getPluginDependencies()`

### FlowItem
- `FlowItem->id` and `FlowItem->category` property is now private.
- FlowItemの権限は，権限レベルではなく権限名を使用するようになりました．
- `FlowItem->getName()`, `FlowItem->getDescription()`, `FlowItem->getDetail()`はabstractになりました．
- アクションはawait-generatorを使用して実行されるようになりました。
- `FlowItem->throwIfInvalidNumber()`がprivateになりました．
  - 代わりに`FlowItem->getInt()`と`FlowItem->getFloat()`を使用してください．
- 以下のメソッドが移動/名前変更されました
  - `FlowItem->execute()` -> `FlowItem->onExecute()`
  - `FlowItemExecutor->executeGenerator()` -> `FlowItemExecutor->getExecutor()`
- 以下のメソッドのシグネチャが変更されました
  - `FlowItem->__construct()` -> `FlowItem->__construct(string $id, string $category, array $permissions = [])`
  - `FlowItem->getPermission(): int` -> `FlowItem->getPermissions(): string[]`
  - `FlowItemExecutor->execute(bool $first = true): bool` -> `FlowItemExecutor->execute(): bool`
- 以下のトレイトが追加されました
  - `aieuo\mineflow\flowItem\base\ActionNameWithMineflowLanguage`
  - `aieuo\mineflow\flowItem\base\ConditionNameWithMineflowLanguage`
- 以下のメソッドが追加されました
  - `FlowItem->setPermissions()`
- 以下のメソッドが削除されました
    - `FlowItem->throwIfCannotExecute()`
    - `FlowItem->getEditFormElements()`
        - 代わりに`FlowItem->buildEditForm()`を使用してください．
    - `FlowItem->parseFromFormData()`
        - 代わりに`EditFormResponseProcessor->preprocess()`を使用してください．
    - `EntityFlowItem->throwIfInvalidEntity()`
      - 代わりに`EntityFlowItem->getOnlineEntity()`を使用してください．
    - `PlayerFlowItem->throwIfInvalidPlayer()`
      - 代わりに`PlayerFlowItem->getOnlinePlayer()`を使用してください．
    - `FlowItemExecutor->resume()`
    - `FlowItemExecutor->exit()`
- 以下のプロパティが削除されました．
  - `FlowItem->name`
    - 代わりに`FlowItem->getName()`, `ActionNameWithMineflowLanguage`, `ConditionNameWithMineflowLanguage`を使用してください．
  - `FlowItem->detail`
    - 代わりに`FlowItem->getDetail()`, `ActionNameWithMineflowLanguage->getDetailReplaces()`, `ConditionNameWithMineflowLanguage->getDetailReplaces()`を使用してください．
  - `FlowItem->detailDefaultReplace`
    - Use `ActionNameWithMineflowLanguage->getDetailDefaultReplaces()`, or `ConditionNameWithMineflowLanguage->getDetailDefaultReplaces()` instead.

### Trigger
- トリガーデータは `トリガー` クラスで保持しなくなりました．
- 以下のクラスが移動/名前変更されました
  - `aieuo\mineflow\ui\trigger\TriggerForm` -> `aieuo\mineflow\trigger\TriggerForm`
  - `aieuo\mineflow\ui\trigger\BaseTriggerForm` -> `aieuo\mineflow\trigger\BaseTriggerForm`
- 以下のメソッドが移動/名前変更されました
  - `Trigger->__construct(string $type, string $key, string $subKey = "")` -> `Trigger->__construct(string $type)`
  - `Trigger->getVariables($data)` -> `Trigger->getVariables(mixed $data)`
  - `Triggers::getTrigger()` -> `Triggers::deserialize()`
  - `TriggerForm->sendAddedTriggerMenu` -> `TriggerForm->buildAddedTriggerMenu()`
  - `EventTrigger->isEnabled()` -> `EventManager->isTriggerEnabled()`
  - `EventTrigger->setEnabled()` -> `EventManager->setTriggerEnabled()`, `EventManager->setTriggerDisabled()`
- 以下のメソッドが追加されました
  - `Trigger->hash()`
  - `Trigger->equals()`
  - `Trigger->serialize()`
  - `Trigger::deserialize()`
  - `TriggerHolder->getRecipesByType()`
  - `EventManager->isTriggerEnabledByEventName()`
  - `EventTriggerListener->unregisterEvent()`
  - `EventTriggerListener->getRegisteredListener()`
- 以下のメソッドが削除されました
  - `Trigger::create()`
  - `Trigger->getKey()`
  - `Trigger->setKey()`
  - `Trigger->getSubKey()`
  - `Trigger->setSubKey()`
  - `TriggerHolder->getRecipesWithSubKey()`
